var app = app || {};

app.createLevelNine = function() {
    app.starfield.loadTexture("levelEightBackground", 0, false);
    app.player.loadTexture("levelNineShip", 0, false);
    app.player.animations.add('fly', [1, 2]);

    _.each(app.bullets.children, function(bullet) {
        bullet.loadTexture("levelNineBullet", 0, false);
        bullet.animations.add('pulse', [0, 1, 2]);
        bullet.animations.play('pulse', 20, true);
    });

    _.each(app.explosions.children, function(explosion) {
        explosion.loadTexture("levelNineKaboom", 0, false);
    });

    app.aliensSpawnTime = 20000;

    app.createAliensLevelNine();
    app.stateText.visible = false;
    app.levelCounter ++;
    // app.preloadLevelSeven();

}

app.createAlienGroupTopBottomLevelNine = function(x, y, num, alienMove) {

    var alienArray = [];

    for (var i = 0; i < num; i++) {

        var alien = app.aliens.create(_.random(0, x), y, 'levelNineSeeker');
        alien.anchor.setTo(0.5, 0.5);
        // alien.animations.add('fly', [ 0, 1, 2, 3 ], 20, true);
        // alien.play('fly');
        alien.body.moves = false;
        alienArray.push(alien);
    }

    _.each(alienArray, function(alien){

        setTimeout(function() {
            app.game.time.events.loop(Phaser.Timer.SECOND * .01, alienMove, this, alien);

            // app.game.physics.arcade.moveToObject(alien, app.player, 120, 10000);
        }, _.random(1000, app.aliensSpawnTime) );

    });

}

app.createAlienGroupLeftRightLevelNine = function(x, y, num, alienMove) {
 
    var alienArray = [];

    for (var i = 0; i < num; i++) {

        var alien = app.aliens.create(x, _.random(0, y), 'levelNineSeeker');
        alien.anchor.setTo(0.5, 0.5);
        // alien.animations.add('fly', [ 0, 1, 2, 3 ], 20, true);
        // alien.play('fly');
        alien.body.moves = false;
        alienArray.push(alien);
    }

    _.each(alienArray, function(alien){

        setTimeout(function() {
            app.game.time.events.loop(Phaser.Timer.SECOND * .01, alienMove, this, alien);

            // app.game.physics.arcade.moveToObject(alien, app.player, 120, 1000);

        }, _.random(1000, app.aliensSpawnTime) );

    });

}

app.createAliensLevelNine = function() {

    // Reset aliens position
    app.aliens.x = 0;
    app.aliens.y = 0;

    seekerNum = 12;
    num = seekerNum / 4;

    // Asteroid group moving from top to bottom
    app.createAlienGroupTopBottomLevelNine(800, -300, num, app.descendLevelFour);

    // Asteroid group moving from bottom to top
    app.createAlienGroupTopBottomLevelNine(800, 950, num, app.ascendLevelFive);

    // Asteroid group moving from left to right
    app.createAlienGroupLeftRightLevelNine(-300, 650, num, app.moveRightLevelFour);

    // Asteroid group moving from right to left
    app.createAlienGroupLeftRightLevelNine(1200, 650, num, app.moveLeftLevelFour);

}

app.collisionHandlerLevelNine = function(bullet, alien) {
    app.totalKillCount += 1;


    //  When a bullet hits an alien we kill them both
    bullet.kill();
    alien.kill();

    //AUDIO enemy is hit by bullet -K

    soundCall = new Howl({
    urls: [playSound("enemyHit")]
    }).play();

    //  Increase the score
    app.score += 20;
    app.scoreText.text = app.scoreString + app.score;

    //  And create an explosion :)
    var explosion = app.explosions.getFirstExists(false);
    explosion.reset(alien.body.x, alien.body.y);
    explosion.play('kaboom', 30, false, true);


}

app.preloadLevelSeven = function(){


    app.game.load.start();

};



// app.enemySeeking = function(){

//     app.livingEnemies.length=0;

//     app.aliens.forEachAlive(function(alien){

//         // put every living enemy in an array
//         app.livingEnemies.push(alien);
//     });

//     var shooter=_.sample(app.livingEnemies);
//         app.game.physics.arcade.moveToObject(shooter,app.player,120);
//     app.enemySeekerTimer = app.game.time.now + 2000;

// };

// app.descendLevelEight = function(alien) {

//     // alien.position.y += app.aliensVelocity;
//      if (app.game.time.now > app.enemySeekerTimer) {
//                     app.enemySeeking();
//                 } 

//     if (alien.worldPosition.y > app.game.world.bounds.bottom) {
//         alien.kill();
//     }

// }

// app.moveRightLevelEight = function(alien) {

//     // alien.position.x += app.aliensVelocity;
//      if (app.game.time.now > app.enemySeekerTimer) {
//                     app.enemySeeking();
//                 } 

//     if (alien.worldPosition.x > app.game.world.bounds.right) {
//         alien.kill();
//     }

// }

// app.moveLeftLevelEight = function(alien) {

//     // alien.position.x -= app.aliensVelocity;
//      if (app.game.time.now > app.enemySeekerTimer) {
//                     app.enemySeeking();
//                 } 

//     if (alien.worldPosition.x < app.game.world.bounds.left) {
//         alien.kill();
//     }
// }


// app.ascendLevelEight = function(alien) {

//     // alien.position.y -= app.aliensVelocity;
//      if (app.game.time.now > app.enemySeekerTimer) {
//                     app.enemySeeking();
//                 } 

//     if (alien.worldPosition.y < app.game.world.bounds.top) {
//         alien.kill();
//     }

// }